<p>There is a much easier way to solve F.</p> <p>A classic conversion is that:</p>   <center>$$$ n^k=\sum\limits_{i=0}^k S(k,i)\binom{n}{i}i! $$$</center> <p>Using the above formula:</p>   <center>$$$ \begin{aligned} \sum\limits_{F} F^k&amp;=\sum\limits_{F}\sum\limits_{i=0}^k S(k,i)\binom{F}{i}i!\\ &amp;=\sum\limits_{i=0}^k S(k,i)i!\color{red}{\sum\limits_F \binom{F}{i}} \end{aligned} $$$</center> <p>Consider the combinatorial meaning of the red part. It chooses some boxes to take out balls with odd numbers, then it chooses $$$i$$$ of them, and calculate the number of ways. Let's reverse the steps, we can find out that the answer to the red part is equal to the number of ways to perform the following steps:</p>   <ol> <li>Choose $$$i$$$ balls.</li> <li>Let the chosen balls be odd numbers. No constraints on the rest of the balls.</li> </ol> <p>Thus, the answer can be simplified as follows:</p>   <center>$$$ \begin{aligned} \sum\limits_{i=0}^k S(k,i)i!\sum\limits_F \binom{F}{i}&amp;=\sum\limits_{i=0}^k S(k,i)i!m^{n-i}\left\lceil{m\over 2}\right\rceil^i \end{aligned} $$$</center> <p>which can be solved in $$$\mathcal{O}(k^2)$$$.</p> <<===>> 
<p>Amazing solution, thanks for the help!</p> <<===>> 
<p>But when I read your code, I see your formula is (n!/i!) instead of i!. Can you help me ? (Sorry for bad English T_T) </p> <<===>> 
